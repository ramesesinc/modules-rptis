<style type="text/css">
.fade.in {
    background: #00000030;
}
.close {
    line-height: .6;
}
#barcode {
    float: right;
    height:80px;
}

@media print {
  .navbar-inverse{display:none}
  .footer{display:none}
  .no-print{display:none}
  .print{margin:30px}
  .left{float:left}
  .right{right}
  #blackbar{display:none}
  #Header, #Footer { display: none ! important; }
  @page {size: auto;margin: 0mm;}
}
@media screen{
  #barcode{display:none;}
}
</style>


<%
  def barcode = "56001:" + PARAMS.refno
%>
<script src="/res/bpls/JsBarcode.code128.min.js"></script>

<script>
	\$put( "viewbill", new function() {

		var self = this;
		this.error;
    this.selectedItem;
    this.billperiod;

		this.refno = WindowUtil.getParameter("refno");
		this.qtr = WindowUtil.getParameter("qtr");
    this.year = WindowUtil.getParameter("year");


    this.qtrs;
    this.years;

		var app = \$get("billing").code;
    this.lgu = app.lgu;

		this.onload = function() {
      this.bill = app.bill;
      if(!this.qtr) this.qtr = 4;
			if( !this.bill ) {
        var p = {refno: self.refno, qtr: this.qtr };
				app.loadBill( p, function() {
					self._controller.reload();
				});
			}
      else {
        this.qtrs = [4,3,2,1];
        this.years = [2001,2002];  
        this.barcode = "56001:"+this.bill.billno; 
      }
		}

    this.recomputeBill = function() {
      var p = {refno: self.refno, qtr: this.qtr }; 
      app.loadBill( p, function() {
        WindowUtil.loadHash("viewbill", p );
      });
      \$('#specifyQtr').modal('hide');
    }


    this.formatDate = function(n) {
      return n;
    }

    this.cancelBill = function() {
        WindowUtil.loadHash("askrefno", null);
    }

    this.createPaymentOrder = function() {
      var svc = Service.lookup(app.orgcode + ":EPaymentService");
      var pp = {refno:this.refno, qtr:this.qtr};
      pp.orgcode = app.orgcode;
      pp.origin = "filipizen";
      pp.txntype = "bpls";
      svc.createPaymentOrder( pp, function(o,s) {
          if( s == "error" ) {
            alert("error " + o.result );
          }
          else {
            var refno = o.result.objid;
            WindowUtil.load( "/epayment/paymentorder", {refno: refno});          
          }  
      });
    }

	})
</script>

<div class="print">

   <section id="services" class="section">
     <div class="container">
         <div class="row">
           <div class="form-group">
             <div class="col-md-12">
               <div class="container">
               <h2>TD No.: <label r:context="viewbill">#{bill.tdno}</label></h2>
                    <div class="row">
                      <div class="col-md-6">
                           <dl>
                               <dt>Property Owner :</dt>
                               <dd><label r:context="viewbill">#{bill.taxpayer.name}</label></dd>
                           </dl>
                            <dl>
                                <dt>Address :</dt>
                                <dd><label r:context="viewbill">#{bill.taxpayer.address}</label></dd>
                            </dl> 
                        </div> 
                        <div class="col-md-4">
                             <dl>
                                <dt>Bill No. :</dt>
                                <dd><label r:context="viewbill">#{bill.barcode}</label></dd>
                            </dl>
                            <dl>
                                <dt>Bill Date :</dt>
                                <dd><label r:context="viewbill">#{bill.billdate}</label></dd>
                            </dl>
                      </div>
                      </div>  

              <table class="table" r:context="viewbill" r:items="bill.items" r:varName="k">
                <thead>
                  <tr>
                    <th class="text-right">A.V.</th>
                    <th class="text-center">Period</th>
                    <th class="text-right">Basic</th>
                    <th class="text-right">D/P</th>
                    <th class="text-right">Net Basic</th>
                    <th class="text-right">SEF</th>
                    <th class="text-right">D/P</th>
                    <th class="text-right">Net SEF</th>
                    <th class="text-right">Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="right">#{k.originalav.formatDecimal() }</td>
                    <td align="center">#{k.period}</td>
                    <td align="right">#{k.basic.formatDecimal()}</td>
                    <td align="right">#{k.basicdp.formatDecimal()}</td>
                    <td align="right">#{k.basicnet.formatDecimal()}</td>
                    <td align="right">#{k.sef.formatDecimal()}</td>
                    <td align="right">#{k.sefdp.formatDecimal()}</td>
                    <td align="right">#{k.sefnet.formatDecimal()}</td>
                    <td align="right">#{k.total.formatDecimal()}</td>
                  </tr>
                </tbody>
                <thead>
                  <tr>
                    <th align="left" colspan="3">THIS BILL IS VALID UNTIL <label r:context="viewbill">#{info.expirydate}</label></th>
                    <th class="text-right" colspan="5"> BILL AMOUNT :</th>
                    <th class="text-right">P <label r:context="viewbill">#{bill.amount.formatDecimal()}</label></th>
                  </tr>
                  <tr>
                    <th class="text-right" colspan="8">BILL PERIOD : </th> 
                    <th class="text-right"><label r:context="viewbill">#{bill.billtoqtr + 'Q, ' + bill.billtoyear}</label></th>
                  </tr> 
                  
                </thead>
              </table>
                  
            </div>

           </div>
         </div>
     </div>
    </div>
 </section>
 
<div class="row no-print">
      <div class="col-xs-12">

        <button r:context="viewbill" class="btn btn-primary" r:name="cancelBill"  style="margin-right: 5px;"> Cancel</button>

        <button onclick="location.href='javascript:window.print()';" href="" class="btn-response btn btn-primary" onClick="window.print()"><i class="fa fa-print"></i> Print</button>

        <button type="button" data-toggle="modal" data-target="#specifyQtr"  
            class="btn btn-primary" style="margin-right: 5px;"> Pay Option</button>
        
        <button r:context="viewbill" r:name="createPaymentOrder" r:visibleWhen="#{bill.amount > 0}" class="btn-response btn btn-primary pull-right">
          <i class="fa fa-credit-card"> </i> Pay Now 
        </button>
      </div>
  </div>

  <div class="modal fade" id="specifyQtr" tabindex="-1" role="dialog" aria-labelledby="specifyQtr" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Year: <select r:context="viewbill" r:items="years" r:name="year"></select><br>        
          Qtr: <select r:context="viewbill" r:items="qtrs" r:name="qtr"></select><br>
          <button r:context="viewbill" r:name="recomputeBill" class="submit">OK</button> 
        </div>
      </div>
    </div>
  </div>


</div>

  

