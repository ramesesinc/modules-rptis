<script>
\$put("verifytd", new function() {
	
	var self = this;
	this.refno;
	this.mode = "askref";
	this.error;
	this.info;

	var orgcode = "${PARAMS.info.id}";

	this.search = function() {
		var svc = Service.lookup( orgcode + ":TDService");
		svc.verifyTaxDec( {refno: this.refno}, function(o,s) {
			if( s == "error" ) {
				self.error = o.result;
			}
			else {
				self.error = null;
				self.info = o.result;	
				self.mode = "viewinfo"
				console.log( self.info );
			}
			self._controller.refresh();
		});
	}

});
</script>

<h1>Verify Property</h1>

<div r:context="verifytd" r:visibleWhen="#{error!=null}">
	<label r:context="verifytd" style="color:red;">#{error}</label>
</div>

<div style="padding-top:0px;"  r:context="verifytd" r:visibleWhen="#{mode=='askref'}">
  <div class="row">
      <div class="col-md-12">
        <div class="row">
          <div class="col-md-4">
            <div class="control-group">
                <label class="control-label">Specify TD No.</label>
                
                  <div class="form-group">
                    <div class="input-group">
                      <input type="text" r:context="verifytd" r:name="refno" class="form-control input-response" required/>

                      <span class="input-group-btn">
						<input type="button" value="Submit" r:context="verifytd" r:name="search" 
                        	   class="btn-response btn btn-submit btn-primary" />
                      </span>
                    </div>
                  </div>
              </div> 
          </div>
        </div>
      </div>
  </div>
</div>


<div class="control-group" r:context="verifytd" r:visibleWhen="#{mode=='viewinfo'}">

	<label r:context="verifytd">
	  <br />
	  <h3>Tax Declaration Information</h3>
	  <table>
	    <tr>
	      <td>TD No</td>
	      <td>#{info.tdno}</td>
	    </tr>
	    <tr>
	      <td>Owner</td>
	      <td>#{info.owner.name}</td>
	    </tr>
	    <tr>
	      <td>Address</td>
	      <td>#{info.owner.address}</td>
	    </tr>	    
	    <tr>
	      <td>PIN</td>
	      <td>#{info.pin}</td>
	    </tr>
	    <tr>
	      <td>Title No.</td>
	      <td>#{info.titleno}</td>
	    </tr>
	    <tr>
	      <td>Classification</td>
	      <td>#{info.classcode}</td>
	    </tr>
	    <tr>
	      <td>Lot No.</td>
	      <td>#{info.cadastrallotno}</td>
	    </tr>
	    <tr>
	      <td>Area (sqm)</td>
	      <td>#{info.areasqm}</td>
	    </tr>
	    <tr>
	      <td>Market Value</td>
	      <td>#{info.totalmv}</td>
	    </tr>
	    <tr>
	      <td>Assessed Value</td>
	      <td>#{info.totalav}</td>
	    </tr>
	  </table>
	  <br />

	  <h3>Billing Information</h3>
	  <table>
	    <tr>
	      <td>Period Covered</td>
	      <td>#{info.bill.period}</td>
	    </tr>
	    <tr>
	      <td>Amount Due</td>
	      <td>#{info.bill.amtdue}</td>
	    </tr>
	  </table>
	  <br />

	  <h3>Last Payment Information</h3>
	  <table>
	    <tr>
	      <td>Receipt No.</td>
	      <td>#{info.lastpayment.receiptno}</td>
	    </tr>
	    <tr>
	      <td>Receipt Date</td>
	      <td>#{info.lastpayment.receiptdate}</td>
	    </tr>
	    <tr>
	      <td>Amount Paid</td>
	      <td>#{info.lastpayment.amount}</td>
	    </tr>
	    <tr>
	      <td>Paid By</td>
	      <td>#{info.lastpayment.paidby.name}</td>
	    </tr>
	  </table>
	</label>

</div>


