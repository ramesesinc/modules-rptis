<style type="text/css">
.fade.in {
    background: #00000030;
}
.close {
    line-height: .6;
}
#barcode {
    float: right;
    height:80px;
}

@media print {
  .navbar-inverse{display:none}
  .footer{display:none}
  .no-print{display:none}
  .print{margin:30px}
  .left{float:left}
  .right{right}
  #blackbar{display:none}
  #Header, #Footer { display: none ! important; }
  @page {size: auto;margin: 0mm;}
}
@media screen{
  #barcode{display:none;}
}
</style>


<%
  def barcode = "56001:" + PARAMS.refno
%>
<script src="/res/bpls/JsBarcode.code128.min.js"></script>

<script>
	\$put( "viewbill", new function() {

		var self = this;
		this.error;
    this.selectedItem;
    this.billperiod;

		this.refno = WindowUtil.getParameter("refno");
		this.qtr = WindowUtil.getParameter("qtr");
    this.year = WindowUtil.getParameter("year");

    this.show_owner_name = true;
    this.show_owner_address = true;

    this.qtrs;
    this.years;

		var app = \$get("billing").code;
    this.lgu = app.lgu;

		this.onload = function() {
      this.bill = app.bill;
      if(!this.qtr) this.qtr = 4;
			if( !this.bill ) {
        var p = {refno: self.refno, qtr: this.qtr };
				app.loadBill( p, function() {
					self._controller.reload();
				});
			}
      else {
        this.qtrs = [4,3,2,1];
        this.years = [2001,2002];  
        this.barcode = "56001:"+this.bill.billno; 
      }
		}

    this.recomputeBill = function() {
      var p = {refno: self.refno, qtr: this.qtr }; 
      app.loadBill( p, function() {
        WindowUtil.loadHash("viewbill", p );
      });
      \$('#specifyQtr').modal('hide');
    }


    this.formatDate = function(n) {
      return n;
    }

    this.cancelBill = function() {
        WindowUtil.loadHash("askrefno", null);
    }

    this.createPaymentOrder = function() {
      var svc = Service.lookup(app.orgcode + ":EPaymentService");
      var pp = {refno:this.refno, qtr:this.qtr};
      pp.orgcode = app.orgcode;
      pp.origin = "filipizen";
      pp.txntype = "rptcol";
      svc.createPaymentOrder( pp, function(o,s) {
          if( s == "error" ) {
            alert("error " + o.result );
          }
          else {
            var refno = o.result.objid;
            WindowUtil.load( "/partners/${PARAMS.name}/paymentorder", {refno: refno});          
          }  
      });
    }

	})
</script>

<div class="print">

  <div class="col-md-12">
    <div class="row">
      <label class="col-md-4 col-xs-6 "><STRONG>Bill No.</STRONG><span class="pull-right">:</span></label>
      <div class="col-sm-8 nopadleft">
          <label r:context="viewbill">#{bill.billno}</label>
      </div>
    </div>
    <div class="row">
      <label class="col-md-4 col-xs-6  "><STRONG>Bill Date</STRONG><span class="pull-right">:</span></label>
      <div class="col-sm-8 nopadleft">
        <label r:context="viewbill">#{bill.billdate}</label>
      </div>
    </div>
    <div class="row">
      <label class="col-md-4 col-xs-6  "><STRONG>TD No.</STRONG><span class="pull-right">:</span></label>
      <div class="col-sm-8 nopadleft">
        <label r:context="viewbill">#{bill.tdno}</label>
      </div>
    </div>
    <div class="row">
      <label class="col-md-4 col-xs-6  "><STRONG>Full PIN</STRONG><span class="pull-right">:</span></label>
      <div class="col-sm-8 nopadleft">
        <label r:context="viewbill">#{bill.fullpin}</label>
      </div>
    </div>
    <div class="row" r:context="viewbill" r:visibleWhen="#{show_owner_name == true }">
      <label class="col-md-4 col-xs-6  "><STRONG>Owner Name</STRONG><span class="pull-right">:</span></label>
      <div class="col-sm-8 nopadleft">
        <label r:context="viewbill">#{bill.taxpayer.name }</label>
      </div>
    </div>
    <div class="row" r:context="viewbill" r:visibleWhen="#{show_owner_address == true }">
      <label class="col-md-4 col-xs-6  "><STRONG>Owner Address</STRONG><span class="pull-right">:</span></label>
      <div class="col-sm-8 nopadleft">
        <label r:context="viewbill">#{bill.taxpayer.address}</label>
      </div>
    </div>
    <div class="row">
      <label class="col-md-4 col-xs-6  "><STRONG>Billed Period</STRONG><span class="pull-right">:</span></label>
      <div class="col-sm-8 nopadleft">
        <label r:context="viewbill">#{bill.billperiod}</label>
      </div>
    </div>
    <div class="row">
      <label class="col-md-4 col-xs-6  "><STRONG>Amount</STRONG><span class="pull-right">:</span></label>
      <div class="col-sm-8 nopadleft">
        <STRONG>P <label r:context="viewbill">#{bill.amount.formatDecimal()}</label></STRONG>
      </div>
    </div>
  </div>

  <br>
  <div class="row no-print">
      <div class="col-md-6">

        <button r:context="viewbill" class="btn btn-primary" r:name="cancelBill"  style="margin-right: 5px;"> Cancel</button>

        <button onclick="location.href='javascript:window.print()';" href="" class="btn-response btn btn-primary" onClick="window.print()"><i class="fa fa-print"></i> Print</button>

        <button type="button" data-toggle="modal" data-target="#specifyQtr"  
            class="btn btn-primary" style="margin-right: 5px;"> Pay Option</button>
        
        <button r:context="viewbill" r:name="createPaymentOrder" r:visibleWhen="#{bill.amount > 0}" class="btn-response btn btn-primary pull-right">
          <i class="fa fa-credit-card"> </i> Pay Now 
        </button>
      </div>
  </div>

  <div class="modal fade" id="specifyQtr" tabindex="-1" role="dialog" aria-labelledby="specifyQtr" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Year: <select r:context="viewbill" r:items="years" r:name="year"></select><br>        
          Qtr: <select r:context="viewbill" r:items="qtrs" r:name="qtr"></select><br>
          <button r:context="viewbill" r:name="recomputeBill" class="submit">OK</button> 
        </div>
      </div>
    </div>
  </div>


</div>

  

